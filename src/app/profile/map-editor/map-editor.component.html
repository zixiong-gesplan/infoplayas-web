<ng4-loading-spinner [timeout]="10000" [threshold]="800"></ng4-loading-spinner>
<p-toast [style]="{marginTop: '80px'}" position="top-right"></p-toast>
<div id="listPlayas" class="panel-side scroller esri-widget esri-hidden">
    <ul id="ulPlaya">
        <li>Cargando&hellip;</li>
    </ul>
</div>
<div id="mainContainer" [style.height]="mapHeight">
    <div id="viewDiv"></div>
    <div id="legendDiv" class="card custom-widget"></div>
    <div id="infobutton" class="container-fluid esri-widget custom-widget">
        <div class="row paddingtopbottom10px">
            <div class="col-md-12">
                <a data-fancybox data-type="iframe" [href]="setUrlInfoMap()">
                    <i class="pull-left fa fa-info-circle fa-2x"></i><b>Abre mapa detallado</b></a>
            </div>
        </div>
    </div>
    <div id="info" class="container-fluid esri-widget custom-widget esri-hidden">
        <img src="assets/images/logos/logo.png" class="card-img-top"/>
        <div class="card-body">
            <p id="txtSelecciona" class="card-text">Seleccione Playa/ZBM</p>
        </div>
    </div>
    <div id="mapTopbar">
        <button
            class="action-button esri-icon-measure-line"
            id="distanceButton"
            type="button"
            title="Mide la distancia entre dos puntos."
        ></button>
    </div>
    <div id="formContainer" class="esri-hidden scroller">
        <!--        formulario de peligrosidad-->
        <div [hidden]="selectForm !=='clasificacion'">
            <form class="esri-pad" (click)="onClickDangerForm = true" [formGroup]="formDanger"
                  (ngSubmit)="onSubmit(formDanger, tableIds.tbDanger)">
                <!--            <div [hidden]="!databaseFail" class="alert alert-danger">{{ERROR}}</div>-->
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font">Características de esta zona de baño que representen un <b>GRAVE
                            PELIGRO</b> para la vida humana:</label>
                        <br>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <p-toggleButton formControlName="desprendimientos" onLabel="Desprendimientos"
                                        offLabel="Desprendimientos" onIcon="desprendimientosIcon"
                                        offIcon="desprendimientosIcon"
                                        [style]="{'width':'100%', 'height': '4.5em','text-align': 'right'}"></p-toggleButton>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <p-toggleButton formControlName="contaminacion" onLabel="Contaminación de las aguas"
                                        offLabel="Contaminación de las aguas" onIcon="contaminacionIcon"
                                        offIcon="contaminacionIcon"
                                        [style]="{'width':'100%', 'height': '4.5em','text-align': 'right'}"></p-toggleButton>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <p-toggleButton formControlName="fauna_marina" onLabel="Peligros por fauna marina"
                                        offLabel="Peligros por fauna marina" onIcon="faunaIcon"
                                        offIcon="faunaIcon"
                                        [style]="{'width':'100%', 'height': '4.5em','text-align': 'right'}"></p-toggleButton>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <p-toggleButton formControlName="corrientes_mareas" onLabel="Corrientes y mareas peligrosas"
                                        offLabel="Corrientes y mareas peligrosas" onIcon="corrientesIcon"
                                        offIcon="corrientesIcon"
                                        [style]="{'width':'100%', 'height': '4.5em','text-align': 'right'}"></p-toggleButton>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <p-toggleButton formControlName="rompientes_olas" onLabel="Zona de rompientes y olas"
                                        offLabel="Zona de rompientes y olas" onIcon="rompientesIcon"
                                        offIcon="rompientesIcon"
                                        [style]="{'width':'100%', 'height': '4.5em','text-align': 'right'}"></p-toggleButton>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <div [hidden]="onClickDangerForm" [ngSwitch]="formEvaluation.get('dangerLevel').value">
                            <label *ngSwitchCase="'L'" style="color: green; font-weight : bolder">CLASIFICACIÓN
                                LIBRE</label>
                            <label *ngSwitchCase="'P'" style="color: orange; font-weight : bolder">CLASIFICACIÓN
                                PELIGROSA</label>
                            <label *ngSwitchCase="'UP'" class="esri-font" style="color: red; font-weight : bolder">CLASIFICACIÓN
                                USO
                                PROHIBIDO</label>
                            <label *ngSwitchDefault
                                   pTooltip="Valoración definitiva al final del proceso de introducción de datos"
                                   class="esri-font"
                                   style="color: darkorange; font-weight : bolder">¡SIN Clasificación!, Continúe con el
                                resto de formularios y clasifique al final en Protección/Valoración final</label>
                        </div>
                        <label *ngIf="onClickDangerForm && !viewNoDanger" class="esri-font"
                               style="color: red; font-weight : bolder">CLASIFICACIÓN USO
                            PROHIBIDO</label>
                        <label *ngIf="onClickDangerForm && viewNoDanger"
                               pTooltip="Valoración definitiva al final del proceso de introducción de datos"
                               class="esri-font"
                               style="color: darkorange; font-weight : bolder">¡SIN Clasificación!, Continúe con el
                            resto de formularios y clasifique al final en Protección/Valoración final</label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <button [class]="!formDanger.valid ? 'esri-button esri-button--disabled' : 'esri-button'"
                                type="submit" [disabled]="!formDanger.valid">
                            Guardar
                        </button>
                        <input (click)="sendMessage(0,getUnselectedMessage(), null)"
                               onclick="unselectFeature()"
                               type="button"
                               class="esri-button esri-button--secondary"
                               value="Cancelar"/>
                        <label style="color: red;font-weight: bold" *ngIf="currentUser && !isUserEditor"
                               class="esri-font">* No tiene permisos para
                            editar</label>
                    </div>
                </div>
            </form>
        </div>
        <!--        formulario de valoracion final-->
        <div [hidden]="selectForm !=='valoracion'">
            <form class="esri-pad" [formGroup]="formEvaluation" (ngSubmit)="onSubmitEvaluation()">
                <!--            <div [hidden]="!databaseFail" class="alert alert-danger">{{ERROR}}</div>-->
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font" style="font-weight : bolder">Criterios para clasificar la playa o ZBM
                            como libre
                            o peligrosa en función de las siguientes características:</label>
                        <ul>
                            <li class="esri-legend__service esri-font"><b>Peligrosas:</b> Las que por razones
                                permanentes o circunstanciales reúnan condiciones SUSCEPTIBLES DE PRODUCIR DAÑO AMENAZA
                                INMEDIATA A LA VIDA HUMANA. Se podrá tolerar el uso de las mismas con limitaciones,
                                adoptándose las medidas de seguridad que, en cada caso, se consideren necesarias.
                            </li>
                            <li class="esri-legend__service esri-font"><b>Libres:</b> Las playas no comprendidas en el
                                apartado anterior. Se podrán utilizar para el baño, deportes náuticos y demás
                                actividades de tipo recreativo, con arreglo a la normativa vigente para los mismos.
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <p-dropdown [options]="noDangerOptions" [style]="{'width':'100%'}"
                                    formControlName="dangerLevel"></p-dropdown>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <button class="esri-button" type="submit"
                                [class]="!formEvaluation.valid ? 'esri-button esri-button--disabled' : 'esri-button'"
                                [disabled]="!formEvaluation.valid">
                            Guardar
                        </button>
                        <input (click)="sendMessage(0,getUnselectedMessage(), null)"
                               onclick="unselectFeature()"
                               type="button"
                               class="esri-button esri-button--secondary"
                               value="Cancelar"/>
                        <label style="color: red;font-weight: bold" *ngIf="currentUser && !isUserEditor"
                               class="esri-font">* No tiene permisos para
                            editar</label>
                    </div>
                </div>
            </form>
        </div>
        <!--        formulario de incidencias y usos-->
        <div [hidden]="selectForm !=='incidencias'">
            <form class="esri-pad" [formGroup]="formIncidents"
                  (ngSubmit)="onSubmit(formIncidents, tableIds.tbIncidencias)">
                <!--            <div [hidden]="!databaseFail" class="alert alert-danger">{{ERROR}}</div>-->
                <div class="form-row">
                    <div class="form-group">
                        <i style="color: #1f57ff; margin-top: 2px"
                           pTooltip="Dichos datos podrán interesarse por los Ayuntamientos a la Dirección General de Seguridad y Emergencias, cuando no se dispongan de ellos, que los facilitará de conformidad con los recabados por el CECOES-112 (anexo 1 Decreto 116/2018)."
                           class="pull-left fa fa-info-circle"></i>
                        <label class="esri-font" style="font-weight: bolder">Histórico de Incidencias
                            registradas.</label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <i style="color: #1f57ff; margin-top: 2px"
                           pTooltip="Incidentes que han puesto en peligro la vida de las personas o su integridad física"
                           class="pull-left fa fa-info-circle"></i>
                        <label class="esri-font">Número de incidentes graves</label>
                        <input class="esri-feature-form__input" pInputText type="number" min="0" pattern="^[0-9]+"
                               formControlName="incidentes_graves"/>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <i style="color: #1f57ff; margin-top: 2px" pTooltip="Incidentes con resultado de muerte."
                           class="pull-left fa fa-info-circle"></i>
                        <a href="https://rfess.es/wp-content/uploads/2019/02/Canarias-2015-2018.pdf"
                           class="esri-font" target="_blank"
                           pTooltip="En caso de no disponer de este dato pinche en este enlace">Número de incidentes muy
                            graves</a>
                        <input class="esri-feature-form__input" pInputText type="number" min="0" pattern="^[0-9]+"
                               formControlName="incidentes_mgraves"/>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font">Valor de peligrosidad</label>
                        <input class="esri-feature-form__input" pInputText type="number"
                               [value]="formIncidents.get('incidentes_mgraves').value > 0 ? 5 :
                               formIncidents.get('incidentes_graves').value > 0 ? 3 : 0" disabled="true">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font" style="font-weight: bolder">Actividades deportivas y de recreo que se
                            realizan y existencia de balizamiento.</label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <p-checkbox label="Actividad deportiva"
                                    formControlName="actividades_deportivas" binary="true"
                                    (mouseenter)="formIncidents.get('actividades_deportivas').value ? op1.show($event) : op1.hide()"
                                    (click)="openSecurityMeasures($event,op1)"
                                    [pTooltip]="formIncidents.get('actividades_deportivas').value ? 'Coexisten actividades deportivas, náuticas y de baño' : 'No existen actividades deportivas'">
                        </p-checkbox>
                    </div>
                </div>
                <!--                panel de peligrosidad-->
                <p-overlayPanel #op1>
                    <div class="form-row">
                        <div class="form-group">
                            <p-toggleButton formControlName="balizamiento" onLabel="Balizamiento"
                                            offLabel="Sin balizamiento"></p-toggleButton>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <p-toggleButton formControlName="actividades_acotadas"
                                            onLabel="Sectores deportivos señalizados"
                                            offLabel="Sin señalización"></p-toggleButton>
                        </div>
                    </div>
                </p-overlayPanel>
                <div [style.padding-top.px]="op1.visible ? '115' : '0'" class="form-row">
                    <div class="form-group">
                        <label class="esri-font">Valor de peligrosidad</label>
                        <input class="esri-feature-form__input" pInputText type="number"
                               [value]="calculateDangerLever()" disabled="true">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <button [class]="!formIncidents.valid ? 'esri-button esri-button--disabled' : 'esri-button'"
                                class="esri-button" type="submit" [disabled]="!formIncidents.valid">
                            Guardar
                        </button>
                        <input (click)="sendMessage(0,getUnselectedMessage(), null)"
                               onclick="unselectFeature()"
                               type="button"
                               class="esri-button esri-button--secondary"
                               value="Cancelar"/>
                        <label style="color: red;font-weight: bold" *ngIf="currentUser && !isUserEditor"
                               class="esri-font">* No tiene permisos para
                            editar</label>
                    </div>
                </div>
            </form>
        </div>
        <!--        formulario de afluencia-->
        <div [hidden]="selectForm !=='afluencia'">
            <form class="esri-pad" [formGroup]="formFlow">
                <p-confirmDialog #cd header="Confirmation" icon="pi pi-exclamation-triangle">
                    <p-footer>
                        <button type="button" pButton icon="pi pi-check" label="Si" (click)="cd.accept()"></button>
                        <button type="button" pButton icon="pi pi-times" label="No" (click)="cd.reject()"></button>
                    </p-footer>
                </p-confirmDialog>
                <div class="form-row">
                    <div class="form-group">
                        <i style="color: #1f57ff; margin-top: 2px"
                           pTooltip="Estimación de la densidad de usuarios de una Playa, sector o zona marítima de baño, ponderado en momentos de media marea en las fechas de máximo uso anual, calculados con referencia al año anterior y actualizado anualmente."
                           class="pull-left fa fa-info-circle"></i>
                        <label style="padding-bottom: 5px;" class="esri-font">Añada períodos de Afluencia</label>
                        <p-calendar appendTo="body" formControlName="dates" selectionMode="range"
                                    [readonlyInput]="true" [locale]="es" dateFormat="dd/mm" [minDate]="minDate"
                                    [maxDate]="maxDate" [disabledDates]="invalidDates"
                                    showOtherMonths="false"
                                    placeholder="Indique el nivel de afluencia para cada período"
                                    [defaultDate]="minDate" [numberOfMonths]="2"
                                    [showIcon]="true">
                            <p-footer>
                                <div class="form-row">
                                    <p-button label="Guardar "
                                              icon="pi pi-plus-circle"
                                              (onClick)="addPeriod()"
                                              [disabled]="!formFlow.get('flowLevelDefault').value || !formFlow.get('dates').value
                                              || !this.formFlow.get('dates').value[0] || (currentUser && !isUserEditor)">
                                    </p-button>
                                    <span style="margin-left: 2%"></span>
                                    <p-selectButton [options]="FlowOptions" formControlName="flowLevelDefault">
                                    </p-selectButton>
                                    <span style="margin-left: 10%"></span>
                                    <p-selectButton (onOptionClick)="clearWeekendButton($event)" [options]="FlowOptions"
                                                    formControlName="flowLevelWeekend">
                                    </p-selectButton>
                                </div>
                                <div class="form-row">
                                    <label *ngIf="formFlow.get('flowLevelWeekend').value"
                                           style="margin-left: 15%;font-weight: bolder;min-width: 34%; color: #1d78cb"
                                           class="esri-font">Afluencia días laborables</label>
                                    <label *ngIf="!formFlow.get('flowLevelWeekend').value"
                                           style="margin-left: 15%;font-weight: bolder;min-width: 34%;"
                                           class="esri-font">Misma afluencia en todo el período</label>
                                    <label style="margin-left: 10%;font-weight: bolder" class="esri-font">Afluencia
                                        distinta en el fin de semana</label>
                                </div>
                            </p-footer>
                        </p-calendar>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label style="padding-bottom: 5px;" class="esri-font">Leyenda de la tabla de períodos donde la
                            afluencia difiere dentro de cada período. Sin color indica sin cambios:</label>
                        <div class="ui-g">
                            <div style="background-color: darkorange; color: #ffffff !important; width: 50%"
                                 class="ui-g-6">
                                <span>Fin de semana</span>
                            </div>
                            <div style="background-color: darkblue; color: #ffffff !important; width: 50%"
                                 class="ui-g-6">
                                <span>días laborables</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <div *ngIf="this.invalidDates.length < this.days_of_this_year; else completeDates"
                             class="alert alert-warning">
                            <strong>Atención!</strong> Año en curso INCOMPLETO.
                        </div>
                        <ng-template #completeDates>
                            <div class="alert alert-success">
                                <strong>Correcto!</strong> Ha completado los períodos de este Año.
                            </div>
                        </ng-template>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font" style="font-weight: bolder; margin-bottom: 5px">Tabla de Períodos de
                            Afluencia
                            añadidos</label>
                        <p-table [columns]="colsFlow" [value]="periods">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th *ngFor="let col of columns" [width]="col.width"
                                        [pSortableColumn]="col.orderBy">
                                        {{col.header}}
                                        <p-sortIcon [field]="col.orderBy" ariaLabel="Active para ordenar"
                                                    ariaLabelDesc="Active para ordenar en orden descendente"
                                                    ariaLabelAsc="Active para ordenar en orden ascendente"></p-sortIcon>
                                    </th>
                                    <th *ngIf="currentUser && isUserEditor"
                                        pTooltip="Eliminar período de Afluencia" style="width:13%">AC.
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-columns="columns">
                                <tr [ngClass]="{null: rowData.attributes.incluir_dias === 'TD',
                                        'includeDatesFS':rowData.attributes.incluir_dias === 'FS',
                                        'includeDatesLB':rowData.attributes.incluir_dias === 'LB' }">
                                    <td *ngFor="let col of columns" [ngSwitch]="col.type">
                                        <div *ngSwitchCase="'text'">
                                            {{rowData['attributes'][col.subfield]}}
                                        </div>
                                        <div *ngSwitchCase="'year'">
                                            {{rowData['attributes'][col.subfield] | date: 'dd-MMM-yy'}}
                                        </div>
                                        <div *ngSwitchDefault>
                                            {{rowData['attributes'][col.subfield] | date: 'dd-MMM'}}
                                        </div>
                                    </td>
                                    <td *ngIf="currentUser && isUserEditor" style="text-align:center">
                                        <button style="height: 25px; color: #333333" type="button"
                                                (click)="onRowDelete(rowData)">
                                            <i class="fa fa-times"></i>
                                        </button>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <a data-fancybox data-width="640" data-height="360" href="assets/video/afluencia.mp4">
                            <i class="pull-left fa fa-video-camera fa-2x"></i><b>Ayuda calendario períodos</b></a>
                    </div>
                </div>
            </form>
        </div>
        <!--        formulario de entorno fisico y condiciones del mar-->
        <div [hidden]="selectForm !=='entorno'">
            <form class="esri-pad" [formGroup]="formEnvironment"
                  (ngSubmit)="onSubmit(formEnvironment, tableIds.tbEntorno)">
                <!--            <div [hidden]="!databaseFail" class="alert alert-danger">{{ERROR}}</div>-->
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font" style="font-weight: bolder">Condiciones habituales del mar.</label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label style="padding-bottom: 5px;" class="esri-font">Peligrosidad</label>
                        <p-dropdown class="esri-feature-form__input" [options]="wavesOptions"
                                    formControlName="peligrosidad_mar" [style]="{'width':'100%'}"></p-dropdown>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font">Valor de peligrosidad</label>
                        <input placeholder="Seleccione arriba estado de la mar" class="esri-feature-form__input"
                               pInputText type="number"
                               [value]="formEnvironment.get('peligrosidad_mar').value" disabled="true">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font" style="font-weight: bolder">Características físicas y entorno.</label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <i style="color: #1f57ff; margin-top: 2px"
                           pTooltip="Se atenderá a la repercusión que sobre la seguridad de personas usuarias o la respuesta a la emergencia pueden tener el entorno en cuanto a peligros añadidos, dificultades en las comunicaciones, y en accesos para el socorro, auxilio y evacuación. (anexo 1 Decreto 116/2018)."
                           class="pull-left fa fa-info-circle"></i>
                        <label class="esri-font">Número de peligros añadidos</label>
                        <input class="esri-feature-form__input" pInputText type="number" min="0" pattern="^[0-6]"
                               formControlName="peligros_anadidos" (change)="onChangeAdditionalDangers($event)"/>
                    </div>
                </div>
                <div *ngFor="let danger of tEnv.controls; let i = index" class="list-group list-group-flush">
                    <div class="list-group-item">
                        <div [formGroup]="danger" class="esri-pad">
                            <div class="form-group">
                                <label style="padding-bottom: 5px;" class="esri-font">Peligro {{i + 1}}</label>
                                <p-dropdown class="esri-feature-form__input" [options]="additionalDangersOptions"
                                            formControlName="riesgo" [style]="{'width':'100%'}"></p-dropdown>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label style="padding-bottom: 5px;" class="esri-font">Vía de acceso y evacuación</label>
                        <p-dropdown class="esri-feature-form__input" [options]="accessOptions"
                                    formControlName="accesos" [style]="{'width':'100%'}"></p-dropdown>
                    </div>
                </div>
                <!--                panel de info cobertura telefonica-->
                <p-overlayPanel #op2>
                    <img src="assets/images/info/cobertura.png" alt="cobertura telefónica ayuda"/>
                </p-overlayPanel>
                <div class="form-row">
                    <div class="form-group">
                        <div class="ui-g">
                            <div class="ui-inputgroup">
                                <i (mouseenter)="op2.show($event)" style="color: #1f57ff"
                                   class="pull-left fa fa-info-circle fa-2x"></i>
                                <label class="esri-font">Puede consultar la cobertura en el mapa detallado.</label>
                            </div>
                            <div class="ui-g-12">
                                <p-radioButton class="esri-font" name="grupocobertura" value=1
                                               label="Con cobertura telefónica"
                                               formControlName="cobertura_telefonica"></p-radioButton>
                            </div>
                            <div class="ui-g-12">
                                <p-radioButton class="esri-font" name="grupocobertura" value=0
                                               label="Sin cobertura telefónica"
                                               formControlName="cobertura_telefonica"></p-radioButton>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="esri-font">Valor de peligrosidad</label>
                        <input placeholder="Complete el formulario..." class="esri-feature-form__input" pInputText
                               type="number"
                               [value]="formEnvironment.valid && formEnvironment.get('peligros_anadidos').value > 0 ?
                               formEnvironment.get('accesos').value === 'SDIF' ? 1 :
                               formEnvironment.get('accesos').value === 'AVHC' ? 3 : 5 : formEnvironment.valid ? 0 : ''"
                               disabled="true">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <button [class]="!formEnvironment.valid ? 'esri-button esri-button--disabled' : 'esri-button'"
                                type="submit" [disabled]="!formEnvironment.valid">
                            Guardar
                        </button>
                        <input (click)="sendMessage(0,getUnselectedMessage(), null)"
                               onclick="unselectFeature()"
                               type="button"
                               class="esri-button esri-button--secondary"
                               value="Cancelar"/>
                        <label style="color: red;font-weight: bold" *ngIf="currentUser && !isUserEditor"
                               class="esri-font">* No tiene permisos para
                            editar</label>
                    </div>
                </div>
            </form>
        </div>
        <!--        tablas con los campos del catalogo de una playa-->
        <p-dialog header="Campos del catálogo" [(visible)]="openCatalogue" [modal]="true" [responsive]="true"
                  [style]="{width: '850px', minWidth: '640px'}" [minY]="180"
                  [maximizable]="true">
            <p-accordion>
                <div *ngFor="let tb of tableColsCatalogue">
                    <p-accordionTab [header]="sectionNames[tableColsCatalogue.indexOf(tb)]">
                        <p-table [style]="{marginBottom: '20px'}" [columns]="tb" [value]="beachsCatalogue"
                                 [scrollable]="true">
                            <ng-template pTemplate="colgroup" let-columns>
                                <colgroup>
                                    <col *ngFor="let col of columns" [width]="col.width">
                                </colgroup>
                            </ng-template>
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th *ngFor="let col of columns">
                                        {{col.alias}}
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-rowData let-columns="columns">
                                <tr>
                                    <td *ngFor="let col of columns" pEditableColumn [ngSwitch]="col.type">
                                        <div *ngSwitchCase="'drop'">
                                            <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <p-dropdown appendTo="body" [options]="col.items"
                                                                [(ngModel)]="rowData.attributes[col.field]"
                                                                [style]="{'width':'100%'}">
                                                    </p-dropdown>
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    {{rowData.attributes[col.field]}}
                                                </ng-template>
                                            </p-cellEditor>
                                        </div>
                                        <div *ngSwitchCase="'bol'" class="text-center">
                                            <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <p-checkbox [(ngModel)]="rowData.attributes[col.field]"
                                                                binary="true"></p-checkbox>
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    <p-checkbox [(ngModel)]="rowData.attributes[col.field]"
                                                                binary="true"></p-checkbox>
                                                </ng-template>
                                            </p-cellEditor>
                                        </div>
                                        <div *ngSwitchDefault>
                                            <p-cellEditor>
                                                <ng-template pTemplate="input">
                                                    <input pInputText
                                                           [type]="col.type"
                                                           [(ngModel)]="rowData.attributes[col.field]">
                                                </ng-template>
                                                <ng-template pTemplate="output">
                                                    {{rowData.attributes[col.field]}}
                                                </ng-template>
                                            </p-cellEditor>
                                        </div>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </p-accordionTab>
                </div>
            </p-accordion>
            <p-footer>
                <button type="button" pButton icon="pi pi-check" [disabled]="currentUser && !isUserEditor" (click)="saveBeach()" label="Guardar"></button>
                <button type="button" pButton icon="pi pi-close" (click)="openCatalogue=false" label="Cancelar"
                        class="ui-button-secondary"></button>
            </p-footer>
        </p-dialog>
        <!--        formulario propio del api para inventario - datos del catalogo para tecnicos de ayuntamiento-->
        <div [hidden]="selectForm !=='inventario'">
            <div id="form" class="esri-component"></div>
            <input *ngIf="currentUser && !isUserCatalogueEditor" type="button"
                   [class]="currentUser && isUserEditor ? 'esri-button' : 'esri-button esri-button--disabled'"
                   [disabled]="currentUser && !isUserEditor"
                   value="Guardar" id="btnSave"/>
            <!--        botón para modificar el catalogo-->
            <button *ngIf="currentUser && isUserCatalogueEditor" role="button" class="esri-button"
                    (click)="loadCatalogueInfoByid()">Abrir
                catálogo
            </button>
            <input (click)="sendMessage(0,getUnselectedMessage(), null)"
                   onclick="unselectFeature()"
                   type="button"
                   class="esri-button esri-button--secondary"
                   value="Cancelar"/>
            <label style="color: red;font-weight: bold" *ngIf="currentUser && !isUserEditor" class="esri-font">*
                No tiene permisos para
                editar</label>
        </div>
    </div>
</div>
